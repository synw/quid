(function(e){function t(t){for(var n,s,i=t[0],u=t[1],c=t[2],l=0,h=[];l<i.length;l++)s=i[l],Object.prototype.hasOwnProperty.call(a,s)&&a[s]&&h.push(a[s][0]),a[s]=0;for(n in u)Object.prototype.hasOwnProperty.call(u,n)&&(e[n]=u[n]);p&&p(t);while(h.length)h.shift()();return o.push.apply(o,c||[]),r()}function r(){for(var e,t=0;t<o.length;t++){for(var r=o[t],n=!0,s=1;s<r.length;s++){var u=r[s];0!==a[u]&&(n=!1)}n&&(o.splice(t--,1),e=i(i.s=r[0]))}return e}var n={},a={app:0},o=[];function s(e){return i.p+"js/"+({}[e]||e)+"."+{"chunk-07e30bb6":"26568ade","chunk-243353fe":"6ef94f92","chunk-2d0c1d78":"7ca53fde","chunk-2d21645d":"08756b85","chunk-6b704af7":"ac4e6ce3"}[e]+".js"}function i(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.e=function(e){var t=[],r=a[e];if(0!==r)if(r)t.push(r[2]);else{var n=new Promise((function(t,n){r=a[e]=[t,n]}));t.push(r[2]=n);var o,u=document.createElement("script");u.charset="utf-8",u.timeout=120,i.nc&&u.setAttribute("nonce",i.nc),u.src=s(e);var c=new Error;o=function(t){u.onerror=u.onload=null,clearTimeout(l);var r=a[e];if(0!==r){if(r){var n=t&&("load"===t.type?"missing":t.type),o=t&&t.target&&t.target.src;c.message="Loading chunk "+e+" failed.\n("+n+": "+o+")",c.name="ChunkLoadError",c.type=n,c.request=o,r[1](c)}a[e]=void 0}};var l=setTimeout((function(){o({type:"timeout",target:u})}),12e4);u.onerror=u.onload=o,document.head.appendChild(u)}return Promise.all(t)},i.m=e,i.c=n,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/",i.oe=function(e){throw console.error(e),e};var u=window["webpackJsonp"]=window["webpackJsonp"]||[],c=u.push.bind(u);u.push=t,u=u.slice();for(var l=0;l<u.length;l++)t(u[l]);var p=c;o.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},"56d7":function(e,t,r){"use strict";r.r(t);r("e260"),r("e6cf"),r("cca6"),r("a79d");var n=r("2b0e"),a=(r("d3b7"),r("8c4f")),o=r("2f62");function s(){var e="";return void 0!==Object({NODE_ENV:"production",BASE_URL:"/"}).VUE_APP_SERVER_URL?Object({NODE_ENV:"production",BASE_URL:"/"}).VUE_APP_SERVER_URL:e}var i={quidUrl:s(),isProduction:!0},u=i;n["default"].use(o["a"]);var c=new o["a"].Store({state:{isAuthenticated:!1,username:null,action:null,showActionBar:!1,refreshAction:null},mutations:{action:function(e,t){e.action=t,e.showActionBar=!0},endAction:function(e){e.action=null,e.showActionBar=!1},refreshAction:function(e,t){e.action=t,e.showActionBar=!0},endRefreshAction:function(e){e.action=null,e.showActionBar=!1},authenticate:function(e,t){var r=t.username,n=t.token,a=void 0===n?null:n;e.isAuthenticated=!0,e.username=r,a&&!u.isProduction&&(localStorage.setItem("refreshToken",a),localStorage.setItem("username",r))},unauthenticate:function(e){e.isAuthenticated=!1,e.username=null,u.isProduction||(localStorage.removeItem("refreshToken"),localStorage.removeItem("username"))}},getters:{showActionBar:function(e){return e.showActionBar}}}),l=c;n["default"].use(a["a"]);var p=[{path:"/",component:function(){return r.e("chunk-2d0c1d78").then(r.bind(null,"4886"))}},{path:"/users",component:function(){return r.e("chunk-07e30bb6").then(r.bind(null,"e88f"))}},{path:"/groups",component:function(){return r.e("chunk-6b704af7").then(r.bind(null,"3943"))}},{path:"/tokens",component:function(){return r.e("chunk-2d21645d").then(r.bind(null,"c280"))}},{path:"/namespaces",component:function(){return r.e("chunk-243353fe").then(r.bind(null,"1a6b"))}}],h=new a["a"]({mode:"history",base:"/",routes:p});h.afterEach((function(){l.commit("endAction")}));var f=h,d=r("5f5b"),m=r("b1e0"),b=(r("f9e3"),r("2dd8"),function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"main"},[e.isAuthenticated?r("div",[r("the-navbar"),r("b-container",{staticClass:"h-100",attrs:{fluid:""}},[r("b-row",{staticClass:"full-height-content-zone"},[r("b-col",{staticClass:"bg-light"},[r("the-sidebar")],1),r("b-col",{attrs:{cols:"10"}},[r("router-view")],1)],1)],1)],1):r("div",{staticClass:"vertical-center"},[r("div",{staticClass:"inner-block"},[r("the-login")],1)])])}),v=[],g=r("5530"),k=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("b-navbar",{attrs:{toggleable:"lg",type:"dark",variant:"dark"}},[r("b-navbar-brand",{attrs:{tag:"router-link",to:{path:"/"}}},[e._v("Quid")]),r("b-navbar-toggle",{attrs:{target:"nav-collapse"}}),r("b-collapse",{attrs:{id:"nav-collapse","is-nav":""}},[r("b-navbar-nav",{staticClass:"ml-auto"},[r("b-nav-item",{attrs:{tag:"router-link",to:{path:"/namespaces"}}},[e._v("Namespaces")]),r("b-nav-item",{attrs:{tag:"router-link",to:{path:"/users"}}},[e._v("Users")]),r("b-nav-item",{attrs:{tag:"router-link",to:{path:"/groups"}}},[e._v("Groups")]),r("b-button",{staticClass:"ml-3 my-2 my-sm-0",attrs:{size:"sm"},on:{click:e.logout}},[e._v("Logout")])],1)],1)],1)],1)},x=[],w=(r("96cf"),r("1da1")),y={methods:{logout:function(){var e=this;return Object(w["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$store.commit("unauthenticate"),"/"!==!e.$router.currentRoute.path&&e.$router.push({path:"/"}),t.next=4,e.$api.get("/admin/logout");case 4:case"end":return t.stop()}}),t)})))()}}},T=y,O=r("2877"),_=Object(O["a"])(T,k,x,!1,null,null,null),R=_.exports,j=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"mt-3"},[r("div",[r("h4",{staticClass:"text-muted",on:{click:function(t){return e.$router.push("/namespaces")}}},[r("b-icon-box",{staticClass:"mr-1 text-muted"}),e._v("Namespaces ")],1),r("a",{on:{click:function(t){return e.action("/namespaces","addNamespace")}}},[r("b-icon-plus",{staticClass:"mr-1 text-muted"}),e._v("Add ")],1)]),r("div",{staticClass:"mt-3"},[r("h4",{staticClass:"text-muted",on:{click:function(t){return e.$router.push("/users")}}},[r("b-icon-person",{staticClass:"mr-1 text-muted"}),e._v("Users ")],1),r("a",{on:{click:function(t){return e.action("/users","addUser")}}},[r("b-icon-plus",{staticClass:"mr-1 text-muted"}),e._v("Add ")],1)]),r("div",{staticClass:"mt-3"},[r("h4",{staticClass:"text-muted",on:{click:function(t){return e.$router.push("/groups")}}},[r("b-icon-people",{staticClass:"mr-1"}),e._v("Groups ")],1),r("a",{on:{click:function(t){return e.action("/groups","addGroup")}}},[r("b-icon-plus",{staticClass:"mr-1 text-muted"}),e._v("Add ")],1)])])},C=[],$=(r("2ca0"),{methods:{action:function(){var e=Object(w["a"])(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.$route.path.startsWith(t)){e.next=3;break}return e.next=3,this.$router.push(t);case 3:this.$store.commit("action",r);case 4:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}(),a:function(){}}}),A=$,E=(r("ba5d"),Object(O["a"])(A,j,C,!1,null,"00908925",null)),L=E.exports,P=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("b-card",{staticClass:"mb-2",staticStyle:{"max-width":"20rem"},attrs:{title:"Login",tag:"article"}},[r("b-form",{on:{submit:function(t){return t.preventDefault(),e.postForm(t)}}},[r("b-card-text",[r("b-form-group",[r("b-form-input",{attrs:{placeholder:"name"},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1),r("b-form-group",[r("b-form-input",{attrs:{type:"password",placeholder:"password"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1)],1),r("b-button",{attrs:{variant:"primary",type:"submit"}},[e._v("Submit")])],1)],1)},S=[],U={data:function(){return{form:{username:"",password:""}}},methods:{postForm:function(){var e=this;return Object(w["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$api.adminLogin(e.form.username,e.form.password);case 2:r=t.sent,null===r&&e.$store.commit("authenticate",{username:e.form.username,token:e.$api.requests.refreshToken});case 4:case"end":return t.stop()}}),t)})))()}}},q=U,N=Object(O["a"])(q,P,S,!1,null,null,null),B=N.exports,D={components:{TheNavbar:R,TheSidebar:L,TheLogin:B},computed:Object(g["a"])({},Object(o["c"])(["isAuthenticated"])),mounted:function(){if(!u.isProduction){var e=localStorage.getItem("refreshToken");if(e){this.$api.requests.refreshToken=e;var t=localStorage.getItem("username");this.$store.commit("authenticate",t)}}console.log("ENV","production")}},z=D,V=(r("5c0b"),Object(O["a"])(z,b,v,!1,null,null,null)),I=V.exports,W=(r("99af"),r("53ca")),M=(r("3ca3"),r("10d1"),r("ddb0"),r("d4ec")),G=r("bee2"),H=r("ade3"),F=r("5364"),J=r("9bd1"),Q=r("bc3a"),K=r.n(Q);function X(e){var t=e.error,r=e.hasToLogin,n=void 0!==r&&r,a=e.unauthorized,o=void 0!==a&&a;return{hasToLogin:n,error:t,unauthorized:o}}var Y=new WeakMap,Z=function(){function e(t){var r=t.namespace,n=t.axiosConfig,a=t.timeouts,o=void 0===a?{accessToken:"20m",refreshToken:"24h"}:a,s=t.accessTokenUri,i=void 0===s?null:s,u=t.verbose,c=void 0!==u&&u;if(Object(M["a"])(this,e),Object(H["a"])(this,"refreshToken",null),Y.set(this,{writable:!0,value:null}),"string"!==typeof r)throw X({error:"Parameter namespace has to be set"});if("object"!==Object(W["a"])(n))throw X({error:"Parameter axiosConfig has to be set"});this.namespace=r,this.axiosConfig=n,this.axios=K.a.create(this.axiosConfig),this.timeouts=o,this.verbose=c,this.accessTokenUri=i}return Object(G["a"])(e,[{key:"get",value:function(){var e=Object(w["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._requestWithRetry(t,"get");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"post",value:function(){var e=Object(w["a"])(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._requestWithRetry(t,"post",r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"adminLogin",value:function(){var e=Object(w["a"])(regeneratorRuntime.mark((function e(t,r){var n,a,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n="/admin_login",a={namespace:"quid",username:t,password:r},e.prev=2,e.next=5,K.a.post(n,a,this.axiosConfig);case 5:o=e.sent,this.refreshToken=o.data.token,e.next=15;break;case 9:if(e.prev=9,e.t0=e["catch"](2),!e.t0.response){e.next=14;break}if(401!==e.t0.response.status){e.next=14;break}throw X({error:null,unauthorized:!0});case 14:throw X({error:e.t0});case 15:case"end":return e.stop()}}),e,this,[[2,9]])})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"_requestWithRetry",value:function(){var e=Object(w["a"])(regeneratorRuntime.mark((function e(t,r,n){var a,o=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=o.length>3&&void 0!==o[3]?o[3]:0,this.verbose&&console.log(r+" request to "+t),e.next=4,this.checkTokens();case 4:if(e.prev=4,"get"!==r){e.next=11;break}return e.next=8,this.axios.get(t,this.axiosConfig);case 8:return e.abrupt("return",e.sent);case 11:return e.next=13,K.a.post(t,n,this.axiosConfig);case 13:return e.abrupt("return",e.sent);case 14:e.next=37;break;case 16:if(e.prev=16,e.t0=e["catch"](4),!e.t0.response){e.next=36;break}if(401!==e.t0.response.status){e.next=33;break}return this.verbose&&console.log("Access token has expired"),Object(J["a"])(this,Y,null),e.next=24,this.checkTokens();case 24:if(!(a>2)){e.next=26;break}throw X({error:"too many retries"});case 26:return a++,this.verbose&&console.log("Retrying",r,"request to",t,", retry",a),e.next=30,this._requestWithRetry(t,r,n,a);case 30:return e.abrupt("return",e.sent);case 33:throw X({error:e.t0});case 34:e.next=37;break;case 36:throw X({error:e.t0});case 37:case"end":return e.stop()}}),e,this,[[4,16]])})));function t(t,r,n){return e.apply(this,arguments)}return t}()},{key:"checkTokens",value:function(){var e=Object(w["a"])(regeneratorRuntime.mark((function e(){var t,r,n,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(null!==this.refreshToken){e.next=3;break}throw this.verbose&&console.log("Tokens check: no refresh token"),X({error:"No refresh token found",hasToLogin:!0});case 3:if(null!==Object(F["a"])(this,Y)){e.next=21;break}return this.verbose&&console.log("Tokens check: no access token"),e.next=7,this._getAccessToken();case 7:if(t=e.sent,r=t.token,n=t.error,a=t.statusCode,null===n){e.next=18;break}if(401!==a){e.next=17;break}throw this.verbose&&console.log("The refresh token has expired"),X({error:"The refresh token has expired",hasToLogin:!0});case 17:throw X({error:n});case 18:Object(J["a"])(this,Y,r),this.axiosConfig.headers.Authorization="Bearer "+Object(F["a"])(this,Y),this.axios=K.a.create(this.axiosConfig);case 21:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"_getAccessToken",value:function(){var e=Object(w["a"])(regeneratorRuntime.mark((function e(){var t,r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,t={namespace:this.namespace,refresh_token:this.refreshToken},r="/token/access/"+this.timeouts.accessToken,null!==this.accessTokenUri&&(r=this.accessTokenUri),this.verbose&&console.log("Getting an access token from",r,t),e.next=7,K.a.post(r,t,this.axiosConfig);case 7:return n=e.sent,e.abrupt("return",{token:n.data.token,error:null,statusCode:n.status});case 11:if(e.prev=11,e.t0=e["catch"](0),void 0===e.t0.response){e.next=15;break}return e.abrupt("return",{token:null,error:e.t0.response.data.error,statusCode:e.t0.response.status});case 15:return e.abrupt("return",{token:null,error:e.t0,statusCode:null});case 16:case"end":return e.stop()}}),e,this,[[0,11]])})));function t(){return e.apply(this,arguments)}return t}()}]),e}(),ee=new Z({namespace:"quid",timeouts:{accessToken:"5m",refreshToken:"24h"},accessTokenUri:"/admin_token/access/",axiosConfig:{baseURL:u.quidUrl,timeout:5e3,withCredentials:"production"===Object({NODE_ENV:"production",BASE_URL:"/"}).NODE,headers:{"Content-Type":"application/json"}},verbose:u.isProduction});function te(e){if(console.log("API ERROR:",e),void 0===e.response||null===e.response){if("object"===Object(W["a"])(e)&&"error"in e)return void ue.$notify.error("".concat(e.error));ue.$notify.error("".concat(e))}else if(200!==e.response.status){if(404===e.response.status)return void ue.$notify.warning({title:"Not found",content:e.response.uri});ue.$notify.error("".concat(e.response.status," ").concat(e.response.data.error))}}var re={requests:ee,adminLogin:function(){var e=Object(w["a"])(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ee.adminLogin(t,r);case 3:e.next=13;break;case 5:if(e.prev=5,e.t0=e["catch"](0),!e.t0.unauthorized){e.next=12;break}return ue.$notify.warning({title:"Login failed",content:"Authentication refused"}),e.abrupt("return","unauthorized");case 12:return e.abrupt("return",e.t0);case 13:return e.abrupt("return",null);case 14:case"end":return e.stop()}}),e,null,[[0,5]])})));function t(t,r){return e.apply(this,arguments)}return t}(),get:function(){var e=Object(w["a"])(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.requests.get(t);case 3:return r=e.sent,e.abrupt("return",{response:r,error:null});case 7:if(e.prev=7,e.t0=e["catch"](0),!e.t0.hasToLogin){e.next=13;break}return console.log("has to login"),ue.$store.commit("unauthenticate"),e.abrupt("return");case 13:if(te(e.t0),void 0===e.t0.response){e.next=17;break}if(404===e.t0.response.status){e.next=17;break}return e.abrupt("return",{response:null,error:e.t0});case 17:return e.abrupt("return",e.t0);case 18:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(t){return e.apply(this,arguments)}return t}(),post:function(){var e=Object(w["a"])(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.requests.post(t,r);case 3:return n=e.sent,e.abrupt("return",{response:n,error:null});case 7:if(e.prev=7,e.t0=e["catch"](0),!e.t0.hasToLogin){e.next=13;break}return console.log("has to login"),ue.$store.commit("unauthenticate"),e.abrupt("return");case 13:if(te(e.t0),void 0===e.t0.response){e.next=17;break}if(404===e.t0.response.status){e.next=17;break}return e.abrupt("return",{response:null,error:e.t0});case 17:return e.abrupt("return",e.t0);case 18:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(t,r){return e.apply(this,arguments)}return t}()},ne=re,ae=function(e){return{error:function(t){e.$bvToast.toast(t,{title:"Error",variant:"danger",noAutoHide:!0,appendToast:!0})},warning:function(t){var r=t.title,n=t.content;e.$bvToast.toast(n,{title:r,variant:"danger",autoHideDelay:5e3,appendToast:!0})},success:function(t){var r=t.title,n=t.content,a=t.timeOnScreen,o=void 0===a?1500:a;e.$bvToast.toast(n,{title:r,variant:"success",autoHideDelay:o,appendToast:!0})},done:function(t){e.$bvToast.toast(t,{title:"Done",variant:"success",autoHideDelay:1500,appendToast:!0})}}},oe=ae;n["default"].config.productionTip=!1,n["default"].use(d["a"]),n["default"].use(m["a"]);var se={baseURL:u.quidUrl,timeout:5e3,withCredentials:!1};n["default"].prototype.$axiosConfig=se,n["default"].prototype.$api=ne;var ie=new n["default"]({router:f,store:l,render:function(e){return e(I)}}).$mount("#app");n["default"].prototype.$notify=oe(ie);var ue=t["default"]=ie},"5c0b":function(e,t,r){"use strict";var n=r("9c0c"),a=r.n(n);a.a},"9c0c":function(e,t,r){},a187:function(e,t,r){},ba5d:function(e,t,r){"use strict";var n=r("a187"),a=r.n(n);a.a}});
//# sourceMappingURL=app.175e7fa4.js.map